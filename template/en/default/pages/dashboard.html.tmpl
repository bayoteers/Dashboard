[%#
  # The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Example Plugin.
  #
  # The Initial Developer of the Original Code is Canonical Ltd.
  # Portions created by Canonical Ltd. are Copyright (C) 2009
  # Canonical Ltd. All Rights Reserved.
  #
  # Contributor(s): 
  #   Stephen Jayna <ext-stephen.jayna@nokia.com>
  #   Allan Savolainen <ext-jari.a.savolainen@nokia.com>
  #%]

[% USE Bugzilla %]

[% header = BLOCK %]
    <a href="#" id="dashboard-link">Dashboard</a> <img onclick="ReloadWidgets()" src='extensions/Dashboard/web/css/img/reload.png'>
[% END %]

[% PROCESS global/header.html.tmpl
    title = "Bugzilla Dashboard" 
    style_urls = ['extensions/Dashboard/web/css/smoothness/jquery-ui-1.8.5.custom.css','extensions/Dashboard/web/css/dashboard.css','extensions/Dashboard/web/css/colorbox.css']
%]

<script src="extensions/Dashboard/web/js/Base.js"></script>
<script src="extensions/Dashboard/web/js/jquery-1.7.min.js"></script>
<script src="extensions/Dashboard/web/js/jquery-ui-1.8.5.custom.min.js"></script>
<script src="extensions/Dashboard/web/js/jquery.colorbox-min.js"></script>
<script src="extensions/Dashboard/web/js/jquery.jfeed.js"></script>
<script src="extensions/Dashboard/web/js/jquery.jsonrpc.js"></script>

<div id="ajax_message"></div>

[% active_widgets = 0 %]

<div id="dashboard">

  <div id="columns">

    <ul id="column-1" class="column">
      [% FOREACH widget IN top_column %]
      	[% IF widget.id && widget.id > 0 %]
	      	[% active_widgets = active_widgets + 1 %]
      	  <li class="widget color-[% widget.color %]" id="widget[% widget.id %]">
      	    <div class="widget-head">
      	      <h3>[% widget.title %]</h3>
      	    </div>
      	    <div class="widget-content">
      	      <div align='center'><img class='loader' src='extensions/Dashboard/web/css/img/ajax-loader.gif'></div>
      	    </div>
       	  </li>
      	[% END %]
      [% END %]
    </ul>
  
  <br clear="both"> 
  
    <ul id="column0" class="column" style="width:[% column.shift %]%">
      [% cur_column = columns.shift %]
      [% FOREACH widget IN cur_column %]
      	[% IF widget.id && widget.id > 0 %]
	      	[% active_widgets = active_widgets + 1 %]
      	  <li class="widget color-[% widget.color %]" id="widget[% widget.id %]">
      	    <div class="widget-head">
      	      <h3>[% widget.title %]</h3>
      	    </div>
      	    <div class="widget-content">
      	      <div align='center'><img class='loader' src='extensions/Dashboard/web/css/img/ajax-loader.gif'></div>
      	    </div>
       	  </li>
      	[% END %]
      [% END %]
    </ul>
    
    [% FOREACH i IN [1 .. preferences.columns] %]
      [% cur_column = columns.shift %]
      <ul id="column[% i %]" class="column" style="width:[% column.shift %]%">
        [% FOREACH widget IN cur_column %]
          [% IF widget.id && widget.id > 0 %]
	      	[% active_widgets = active_widgets + 1 %]
            <li class="widget color-[% widget.color %]" id="widget[% widget.id %]">
              <div class="widget-head">
                <h3>[% widget.title %]</h3>
              </div>
              <div class="widget-content">
                <div align='center'><img class='loader' src='extensions/Dashboard/web/css/img/ajax-loader.gif'></div>
              </div>
            </li>
          [% END %]
        [% END %]
      </ul>
    [% END %]
  </div>
</div>

<br clear="both"><br>

[% IF widget_error %]
  <script>
    alert("[% widget_error | replace('\"','\\"') %]");
  </script>
[% END %]

<div style="display: none"> <!-- hide templates -->
[% INCLUDE "pages/dashboard_js_templates.html.tmpl" %]
</div> <!-- /hide templates -->

<script>
var DASHBOARD_CONFIG = [% dashboard_config || 'null' %];
</script>
<script src="extensions/Dashboard/web/js/dashboard.js"></script>

[% PROCESS global/footer.html.tmpl %]
